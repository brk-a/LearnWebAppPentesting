#!/usr/bin/bash

# ** goal: get to level 21. password is found viz:
# the `setuid` binary in `home` makes a conn to `localhost on
# a port you pass as a cmd line arg. it reads a line of text from the conn
# and compares it to the password in the previous level (lvl 20).
# if said passwd is correct, it transmits a password for the next level (21)
# hint: execute it w/o args first
# hint 2: have two shell instances logged into bandit20

# ** shell 1
sshpass -p $(cat passwd) ssh bandit20@bandit.labs.overthewire.org -p 2220
cat /etc/bandit_pass/bandit20 | xclip #copy manually to clipboard if no xclip

# ** shell 2
ls #file `suconnect`
ls -la  #permissions for `suconnect` are `-rwsr-x---` 
./suconnect #run w/o args. shows usage

# ** shell 1
nc -lvp 2222 #listen to port 2222

# ** shell 2
./suconnect 2222 #shell 1 shows conn rcvd on port 44064

# ** shell 1
#paste bandit20 password into shell 1
# returns a password (password for bandit21)
# copy bandit21 password to clipboard

# ** shell 2
# says: password matches, sending next password (bandit 21 passwd)
# conn closes
exit #close shell

# ** shell 1
exit #back to our machine
echo p4ssWord > passwd #use the password you copied to clipboard
sshpass -p $(cat passwd) ssh bandit21@bandit.labs.overthewire.org -p 2220

# command `nc` opens TCP connections, sends UDP packets, listens on arbitrary
# TCP and UDP ports, does port scanning and deals with both IPv4 and IPv6
# flag `l` means listen, `v` means verbose and `p` means port
# type `man nc` in terminal and press ENTER