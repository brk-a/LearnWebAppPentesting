#!/usr/bin/bash

# ** goal: get to level 17. creds for next level can be retrieved
# by submitting the password of the current level to  port on localhost.
# said port is between 31000 and 32000, inclusive. some ports have a server
# listening on them; some speak SSL. one server will return the password we
# want; the rest work like a mirror

nmap localhost -p 31000-32000 #5 ports open; service(s) running are unknown
nmap -sV localhost -p 31046,31518,31691,31790,31960 -T4 #port 31518 runs services `ssl` and `echo`
#port 31790 runs `ssl` and an unknown service
# port 31790 appears to be the one we want
openssl s_client -connect localhost:31790 #says "read R BLOCK". blinking cursor
#enter password that we found in `16-forward_to_port`
#output: string `Correct!` and a RSA private key; copy the latter to your machine's clipboard
cd /tmp && mkdir fnbb #name the dir as you wish
cd fnbb
emacs rsafile #paste the RSA key (include the `---BEGIN RSA ... ----` and `--- END RSA ... ----`)
#save and quit
chmod 600 rsafile
ssh -i rsafile bandit17@localhost -p 2220 #we're in
cat /etc/bandit_pass/bandit17 #found password; copy it to your machine's clipboard
exit #back to our machine
echo p4ssWord > passwd #use the password you copied to clipboard
sshpass -p $(cat passwd) ssh bandit17@bandit.labs.overthewire.org -p 2220

# command `nmap` is an open source tool for network exploration and security auditing.
# uses raw IP packets in novel ways to determine what hosts are available on the network, what services
# (application name and version) those hosts are offering, what operating systems (and OS versions) they
# are running, what type of packet filters/firewalls are in use, and dozens of other characteristics
# here, we use flag `sV` to enable  version detection, `p` to specify which ports to scan and `T` to set
# a timing template
# type `man nmap` in terminal and press ENTER
# command `ssh` connects and logs into the specified hostname (with optional user name). said user must
# prove his/her identity to the remote machine using one of several methods depending on the protocol
# version used
# flag `i` to select a file from which the identity (private key) for RSA or DSA authentication is read
# and flag `p` to specify the port to connect to on the remote host
# type `man ssh` in your terminal and press ENTER