# API6:2023 unrestricted access to sensitive business flows
*  the risk of an attacker being able to identify and exploit API-driven workflows
* an API is vulnerable when an attacker is able to leverage an organisation's API request structure to obstruct other users
* said obstruction may be in the form of spamming other users, depleting the stock of highly sought-after items or preventing other users from using expected application functionality
### OWASP attack vector description
* exploitation involves understanding the business model backed by the API, finding sensitive business flows and automating access to these flows to cause harm to the business
### OWASP security weakness description
* lack of a proper view of the API in order to fully support business requirements contributes to the prevalence of this vulnerability
* attackers manually identify what resources (e.g. endpoints) are involved in the target workflow and how they work together
* attackers find a way to bypass mitigation mechanisms assuming they are already in place
### OWASP impacts description
* technical impact is not expected; exploitation may hurt the business in other ways for example: prevent legitimate users from purchasing a product or lead to inflation in the internal economy of a game
### OWASP preventative measures
* mitigation planning should be done in two layers:
    * business - identify the business flows that might harm the business if they are excessively used
    * engineering - choose the right protection mechanisms to mitigate the business risk
* some of the protection mechanisms are more simple while others are more difficult to implement. the following methods are used to slow down automated threats:
    * device fingerprinting: denying service to unexpected client devices (e.g headless browsers) tends to make threat actors use more sophisticated solutions; it is more costly for them
    * human detection: using either captcha or more advanced biometric solutions (e.g. typing patterns)
    * non-human patterns: analyse the user flow to detect non-human patterns (e.g. the user accessed the `add to cart` and `complete purchase` functions in less than one second)
    * consider blocking IP addresses of Tor exit nodes and well-known proxies
* secure and limit access to APIs that are consumed directly by machines (such as developer and B2B APIs). they are an easy target for attackers because they often do not implement all the required protection mechanisms
### more ...
* w.r.t. APIs, a flow is a series of requests and responses that lead to an operation
    - example: a purchase flow for a web application that does not restrict access to a purchase process allows a scalper to automate requests to instantly drain the stock of an item
    - this is where mechanisms, say, a Completely Automated Public Turing test to tell Computers and Humans Apart (CAPTCHA) comes into play
    - a flow that has a CAPTCHA mechanism that requires human interaction interrupts the automated requests and may slow down automated purchasing
    - in the example below, an API flow has been created to automatically check for stock updates and send out an email alert

    ```mermaid
    ---
    title: purchase in-demand product flow
    ---
        flowchart LR
        A[HTTP GET to buy API]--->B[ingest payload]
        B--->C[run a query]
        C--->D[get table results]
        D--->E[text template]
        E--->F{item in stock?}
        F---> |yes| G[send email alert]
        F---> |no| H[drop]
    ```