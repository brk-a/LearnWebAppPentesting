# API4:2023 unrestricted resource consumption
* the provider of the API does not have safeguards in place to prevent excessive use of their API
* the API provider becomes a victim of Denial of Service (DoS) attacks or experiences unnecessary financial costs when there are no restrictions for resource consumption
### OWSAP attck vector description
* exploitation requires simple API requests
* multiple concurrent requests can be performed from a single local computer or by using cloud computing resources
* most of the automated tools available are designed to cause DoS via high loads of traffic; this impacts APIs’ service rate
### OWASP security weakness description
* it is common to find APIs that do not limit client interactions or resource consumption
* crafted API requests, say, those that include parameters that control the number of resources to be returned and perform response status/time/length analysis should allow identification of the issue
* the same is valid for batch operations; impact can be inferred based on service providers’ (e.g. cloud provider) business/pricing model by threat agents even if they do not have visibility over costs impact
### OWASP impacts description
* exploitation leads to DoS beacuse of resource starvation, however, it also leads to an increase in operational costs, example, those related to the infrastructure because of higher CPU demand, increasing cloud storage needs etc
* the OWASP API Security Project states: an API is vulnerable if at least one of the following limits is missing or set inappropriately (e.g. too low/high):
    - execution timeouts
    - maximum allocable memory
    - maximum number of file descriptors
    - maximum number of processes
    - maximum upload file size
    - number of operations to perform in a single API client request (e.g. GraphQL batching)
    - number of records per page to return in a single request-response cycle
    - third-party service providers' spending limit
### OWASP preventative measures
* docker makes it easy to limit memory, CPU, number of restarts, file descriptors and processes
* implement a limit on how often a client can call the API within a defined timeframe
* notify the client when the limit is exceeded by providing the limit number and the time at which the limit will be reset
* add proper server-side validation for query string and request body parameters specifically the one that controls the number of records to be returned in the response
* define and enforce maximum size of data on all incoming parameters and payloads such as maximum length for strings and maximum number of elements in arrays
### more ...
* every API request has a technical and financial cost
* there is an increased risk of denial of service (DoS), distributed denial of service (DDoS), unnecessary financial costs and degradation of the quality of service to other users when API providers do not enforce limitations on resource consumption
* rate limiting plays an important role in the monetisation and availability of APIs; many API providers monetise their APIs by limiting requests and allowing paid customers to request more information
    - RapidAPI, for example, allows some API providers to have infrastructure that automatically scales with the number of requests
    - in these cases, an unlimited number of requests would lead to a significant and easily preventable increase in infrastructure costs
