# API5:2023 broken function-level authorisation (BFLA)
* a vulnerability where API functions have insufficient access control
    - [BOLA][def] is about access to data; BFLA is about altering or deleting said data
* a vulnerable API allows an attacker to perform actions of other roles including administrator ones
* illustration: a fintech API that is susceptible to BOLA allows an attacker to see what is in the bank account of another user; the same API vulnerable to BFLA allows an attacker to transfer funds from other users' accounts to their own
### OWASP attck vector description
* exploitation requires the attacker to send legitimate API calls to an API endpoint that they should not have access to as either anonymous users or regular, non-privileged users
* trivially, exposed endpoints will be easily exploited
### OWASP security weakness description
* authorisation checks for a function or resource are managed at the configuration or code level
* implementing proper checks can be a confusing task because applications may contain many types of roles, groups and complex user hierarchies (e.g. sub-users or users with more than one role)
* it is easier to discover these flaws in APIs since APIs are more structured and accessing different functions is more predictable
### OWASP impacts description
* such flaws allow attackers to access unauthorised functionality
* administrative functions are key targets for this type of attack
* may lead to data disclosure, data loss or data corruption; ultimately, it may lead to service disruption
### OWASP preventative measures
* application/API should have a consistent, easy-to-analyse authorisation module that is invoked from all business functions
    - such protection is mostly provided by one or more components external to the application code
* the enforcement mechanism(s) should deny all access by default and require explicit grants to specific roles for access to every function
* review API endpoints against function level authorisation flaws while keeping in mind the business logic of the application and groups hierarchy
* make sure that all of administrative controllers inherit from an administrative abstract controller that implements authorisation checks based on the user's group/role
* make sure that administrative functions inside a regular controller implement authorisation checks based on the user's group and role
### more ...
* BFLA is a vulnerability where a user of one privilege level can use the API functionality of a different user, user group or another privilege level
* API providers will, often, have different privilege levels for different types of accounts such as: public users, merchants, partners, vendors, administrators and so on
* BFLA can be exploited using unauthorised use of lateral functions, or a similarly privileged group, or it may be exploited for privilege escalation; an attacker uses the functions of a more privileged group
    - particularly interesting API functions to access include those that deal with sensitive information, resources that belong to another group and administrative functionality, say, user account management
* an API that has different privilege levels may use different endpoints to perform privileged actions
    - example: a bank may use the `/{userid}/account/balance` endpoint for a user wishing to access their account information and the `/admin/account/{userid}` endpoint for an administrator that needs to access user account information
    - an attacker will perform administrative actions and/or an account takeover if the application has not implemented access controls correctly
* an API will not always use administrative endpoints for administrative functionality
    - instead, the functionality may be based on HTTP request methods, say, `GET`, `POST`, `PUT` and `DELETE`
    * simply making an unauthorised request with a different method may indicate a BFLA vulnerability if a provider does not restrict the HTTP methods as required
* when testing for BFLA, look for any functionality that an attacker may use to their advantage
    - these functions include but are not limited to: altering user accounts, deleting user resources and gaining access to restricted endpoints
    - example: say an API gives partners the ability to add new users to the partner group but does not restrict this functionality to the specific group. any user may add themselves to any group. moreover, an attacker can add themselves to a group and there is a good chance that they will be able to access that groupâ€™s resources


[def]: ./1-owasp.md