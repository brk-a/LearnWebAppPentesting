# API3:2023 broken object property-level authorisation (BOPLA)
* is the combination of two items from the 2019 OWASP API Security top ten: excessive data exposure and mass assignment
* excessive data exposure takes place when an API provider responds to a request with an entire data object instead of what is required
    - think TMI for APIs
* an API provider will, usuaaly, filter out the data object down to what is being requested
    - the data object shared w/o being filtered increases risk of exposing sensitive information
* mass assignment is a weakness that allows for user input to alter sensitive object properties
    - example: an API that uses a special property to create admin accounts only authorised users should be able to make requests that successfully alter those administrative properties. if there are no restrictions in place then an attacker would be able to elevate their privileges and perform administrative actions
### OWASP attack vector description
* APIs may expose endpoints that return all of an object’s properties
* this is particularly valid for REST APIs
* other protocols such as GraphQL may require crafted requests to specify which properties should be returned
* identifying these additional properties that can be manipulated requires more effort, however, there are a few automated tools available to assist in this task
### OWASP security weakness description
* inspecting API responses is enough to identify sensitive information in returned objects’ representations
* fuzzing is usually used to identify additional (hidden) properties
* whether or not they can be changed depends on how the API request is crafted and the response analysed
* side-effect analysis may be required if the target property is not returned in the API 
### OWASP impacts decription
* unauthorised access to private/sensitive object properties may result in data disclosure, data loss or data corruption
* under certain circumstances, unauthorised access to object properties can lead to privilege escalation or partial/full account takeover
### OWASP preventative measures
* always make sure that the user should have access to the object's properties you expose when exposing an object using an API endpoint
* avoid generic methods such as `to_json()` and `to_string()`. instead, cherry-pick specific object properties you specifically want to return
* if possible, avoid using functions that automatically bind a client's input into code variables, internal objects or object properties (_mass assignment_)
* allow changes to the object's properties that should be updated by the client and no more
* implement a schema-based response validation mechanism as an extra layer of security. as part of this mechanism, define and enforce data returned by all API methods
* keep returned data structures to the bare minimum according to the business/functional requirements for the endpoint
### more ...
* BOPLA, often, occurs in cases when the provider expects the API consumer to filter results of a request
* a consumer requests specific information. the provider responds with all sorts of information and assumes that the consumer will remove any data they do not require from the response
* when this vulnerability is present, it can be the equivalent of asking someone for their name and having them respond with their name, date of birth, email address, phone number and the identification of every other person they know
* example: an API consumer requests information for their user account and receives information about other user accounts as well; the API is exposing excessive data
    * example request

        ```bash
            GET /community/api/v2/community/posts/recent
        ```

    * example BOPLA response body

        ```json
            [
                {
                        "nickname": "string",
                    "id": "string",
                    "title": "string",
                    "content": "string",
                    "author": {
                    "email": "string",
                        "vehicleID": "string",
                        "profile_pic_url": "string",
                        "created_at": "string",
                    },
                    "comments": [
                        "string",
                    ],
                    "authorID": 0,
                    "created_at": "string"
                }
            ]
        ```

* example of mass assignment: add `isAdmin` property to user object when creating it
    - `POST /community/api/v2/community/members/create`

    * request body/payload

        ```json
            {
                "user": "goatmatata",
                "password": "iamthegoat"
            }
        ```

    * request body can be modified viz:

        ```json
            {
                "user": "goatmatata",
                "password": "iamthegoat",
                "isAdmin": true
            }
        ```

    * the API is vulnerable to mass assignment when the API does not sanitise the request body