# beyond top 10: business logic flaws
* are weaknesses w/i applications that are unique to the policies and features of a given API provider
* the exploitation of business logic takes place when an attacker leverages trust in or features of an application against the API
* identifying business logic vulnerabilities can be challenging due to the unique nature of each business
* the impact of these vulnerabilities can range based on the severity of the vulnerable policy or feature
### attack vector description
* business logic vulnerabilities are unique to each application; they exploit the intended functioning of an application's business processes
* they often require specific knowledge of the application's functionality and the flow of transactions or data
* these vulnerabilities are specific to the business logic of each application; there is no one-size-fits-all approach to identifying them
### security weakness description
* business logic vulnerabilities arise when the assumptions and constraints of a given business process are not properly enforced in the application's control structures
* this allows users to manipulate the application's functionality to achieve outcomes that are detrimental to the business
* said weaknesses typically occur when developers fail to anticipate the various ways that an application's features can be misused or when they do not consider the wider context of the rules they are applying to said business logic
* this is often due to a lack of comprehensive understanding of the application's business logic, a lack of input validation or incomplete function-level authorisation checks
### impacts description
* business logic vulnerabilities causes a variety of technical impacts depending on the specific flaw and the systems involved
* these impacts can range from unauthorised access to data or functionality to a total bypass of system controls
### preventative measures
* use a threat modelling Aaproach: understand the business processes and workflows your API supports
    - identify the potential threats, weaknesses and risks during the design phase to help uncover and mitigate business logic vulnerabilities
* reduce or remove trust relationships with users, systems or components
    - business logic vulnerabilities can be used to exploit these trust relationships leading to broader impacts
* regular training can help developers to understand and avoid business logic vulnerabilities
    - training must cover secure coding practices, common vulnerabilities and how to identify potential issues during the design and coding phases
* implement a bug bounty programme, third-party penetration testing or a responsible disclosure policy
    - this allows security researchers, who are a step removed from the design and delivery of an application, to disclose vulnerabilities they discover in APIs
### more ...
* business logic vulnerabilities (also known as business logic flaws or BLF) are features of an application that attackers can use maliciously
    - for example: an API has an upload feature that instructs users to only upload certain encoded payloads but does not validate the encoded payloads
    - a user could upload any file as long as it was encoded; this allows end users to upload and potentially execute arbitrary code including malicious payloads
* the Experian partner API leak, in early 2021, is a great example of an API trust failure
    - a certain Experian partner was authorised to use Experian’s API to perform credit checks but the partner added the API’s credit check functionality to their web application and inadvertently exposed all partner-level requests to users
    - this request could be intercepted when using the partner’s web application and if it included a name and address, the Experian API would respond with the individual’s credit score and credit risk factors
    - one of the leading causes of this business logic vulnerability was that Experian trusted the partner to not expose the API
* another problem with trust is that credentials, like API keys, tokens and passwords, are constantly being stolen and leaked
    - the consumer can become a wolf in sheep’s clothing and wreak havoc when a trusted consumer’s credentials are stolen
    - w/o strong technical controls in place, business logic vulnerabilities can often have the most significant impact and lead to exploitation and compromise
* examine an API's documentation for tell-tale signs of business logic vulnerabilities  - statements like the following should be indications of potential business logic flaws:
    - >Only use feature X to perform function Y
    - >Do not do X with endpoint Y
    - >Only admins should perform request X
    - these statements may indicate that the API provider is trusting that you will not do any of the discouraged actions as instructed
    - an attacker does not care about rules; s/he will use such requests to test for the presence of technical security controls
* developers assume that consumers will exclusively use a browser to interact with the web application and will not capture API requests that take place behind the scenes; this is naive
    - all it takes to exploit this sort of weakness is an attacker to intercept requests and alter the API request before it is sent to the provider
    - this allows the attacker to capture shared API keys or use parameters that could negatively impact the security of the application
    - example: consider a web application authentication portal that a user would normally employ to authenticate to their account. say the web application issued the following API request:

        ```text
        POST /api/v1/login HTTP 1.1
        Host: goatmatata.com
        --snip--
        UserId=goatmatata&password=goatmatataspassword!&MFA=true
        ```

    - there is a chance that an attacker could bypass multifactor authentication by simply altering the parameter MFA to false
* testing for business logic flaws is challenging because each business is unique
    - automated scanners have a difficult time detecting these issues seeing as the flaws are part of the API’s intended use
    - you must understand how the business and API(s) operate and then consider how an attacker could use these features to their advantage
    - one method of testing for business logic flaws is to study the application’s business logic with an adversarial mindset and try breaking any assumptions that have been made