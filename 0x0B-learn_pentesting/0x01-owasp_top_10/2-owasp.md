# API2:2023 broken authentication
* any weakness within the API authentication process
    - all APIs that contain sensitive information should have some mechanism to authenticate users
    - authentication is the process that is used to verify the identity of an API user; said user is a person, device or system
    - in other words, authentication is the process of verifying that an entity is who that entity claims to be
    - said verification process is done with the use of a username and password, token and/or multi-factor authentication
* authentication-related vulnerabilities, typically, occur when an API provider either does not implement a strong authentication mechanism or implements an authentication process incorrectly
### OWASP attack vector description
* the authentication mechanism is an easy target for attackers because it is exposed to everyone
* exploitation tools are generally available, however, more advanced technical skills may be required to exploit some authentication issues
### OWASP security weakness description
* software and security engineers’ misconceptions regarding authentication boundaries and inherent implementation complexity make authentication issues prevalent
* methodologies of detecting broken authentication are available and easy to create
### OWASP impacts description
* attackers can gain complete control of other users’ accounts in the system, read their personal data and perform sensitive actions on their behalf
* systems are unlikely to be able to distinguish attackers’ actions from legitimate user ones
### OWASP preventative measures
* know all the possible flows to authenticate to the API (mobile/web/deep links that implement one-click authentication/etc.). ask your engineers what flows you missed
* read about your authentication mechanisms. make sure you understand what and how they are used. OAuth is not authentication; neither are API keys. repeat: OAuth is not authentication; neither are API keys
* do not reinvent the wheel in authentication, token generation or password storage; use the standards
* credential recovery/forgot-password endpoints must be treated as login endpoints in terms of brute force, rate limiting and lockout protections
* require re-authentication for sensitive operations (e.g. changing the account owner email address/2FA phone number)
* use the [OWASP Authentication Cheatsheet][def]
* implement multi-factor authentication by default
* implement anti-brute force mechanisms to mitigate credential stuffing, dictionary attacks and brute force attacks on your authentication endpoints. this mechanism should be stricter than the regular rate limiting mechanisms on your APIs
* implement [account lockout][def2]/captcha mechanisms to prevent brute force attacks against specific users. implement weak-password checks
* API keys should not be used for user authentication; they should only be used for [API clients][def3] authentication
### more ...
* broken authentication is a significant security issue due to poor password policies, weak authentication mechanisms and misconfigurations
* API authentication is a complex process that is commonly found with most APIs and is necessarily exposed
* the impact of broken authentication can lead to an attacker taking control of user accounts, compromising personal data and conducting sensitive actions, say, editing healthcare data
* the authentication process is, often, one of the first lines of defence for APIs and when this mechanism is vulnerable, it can lead to a data breach
#### weak password policy
* aweak password policy does not sufficiently protect user accounts by enforcing strong password creation and management
    - allows users to create simple passwords
    - allows brute force attempts against user accounts
    - allows users to change their passwords without asking for password confirmation
    - allows users to change their account emails without asking for password confirmation
    - discloses token or password in the URL
    - GraphQL queries allow for many authentication attempts in a single request
    - lacks authentication for sensitive requests
#### credential stuffing
* a type of attack against authentication
* a large number of username and password combinations are attempted
* credentials used in these types of attacks are, typically, collected from data breaches 
    - allows users to brute force many username and password combinations
#### predictable tokens
* predictable tokens are any tokens obtained through a weak token generation authentication process
* weak tokens can easily be guessed, deduced or calculated by an attacker
    - using incremental or guessable token IDs
#### misconfigured JWTs
* JSON Web Tokens (JWTs) are used for API authentication and authorisation processes
* JWTs provide developers with the flexibility to customise which algorithm is used for signing the token, the key/secret that is used and the information used in the payload
* this customisation allows for plenty of room for security misconfigurations to occur
    * API provider accepts unsigned JWT tokens
    * API provider does not check JWT expiration
    * API provider discloses sensitive information within the encoded JWT payload
    * JWT is signed with a weak key
#### even more ...
* API authentication can be a complex system that includes several processes with a lot of room for failure
> “the future of digital systems is complexity and complexity is the worst enemy of security”
> Bruce Schneier, security expert
* the six constraints of REST APIs: RESTful APIs are designed to be stateless
    - in order to be stateless, the API provider need not remember the consumer from one request to another
    - for this constraint to work, APIs often require users to undergo a registration process in order to obtain a unique token
    - said token that is generated is then used in subsequent requests for authentication and authorisation.
* the registration process used to obtain an API token, the token handling and the system that generates the token could all have their own sets of weaknesses
    - if the token generation process does not rely on a high level of randomness or entropy, there is a chance that an attacker will be able to create their own token or hijack another user's token
* other authentication processes that could have their own sets of vulnerabilities are aspects of the registration system, say, password reset and multi-factor authentication features
    - example: a password reset feature that requires you to provide an email address and a six-digit code to reset your password
        - say the API allowed you to make as many requests as you wanted: you would only have to make one million requests in order to guess the code and reset any user’s password
        - a four-digit code would require only ten thousand requests etc

[def]: https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html
[def2]: https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/04-Authentication_Testing/03-Testing_for_Weak_Lock_Out_Mechanism(OTG-AUTHN-003)
[def3]: https://cloud.google.com/endpoints/docs/openapi/when-why-api-key