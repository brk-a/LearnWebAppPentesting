# OWASP top 10
* OWASP &rarr; open web application security project
* 2023 OWASP API security top 10
    * API1 &rarr; broken object-level authorisation
    * API2 &rarr; broken authorisation
    * API3 &rarr; broken object property-level authorisation
    * API4 &rarr; unrestricted resource consumption
    * API5 &rarr; broken function-level authorisation
    * API6 &rarr; server-side request forgery
    * API7 &rarr; security misconfiguration
    * API8 &rarr; lack of protection from automated threats
    * API9 &rarr; improper assets management
    * API10 &rarr; unsafe consumption of APIs
### API1 : 2023 broken object-level authorisation
* aka BOLA
*  manipulate IDs and gain access to records that do not belong to you
#### example
* authenticate as user A but retrieve data as user B
#### risk exposure
* data loss
* disclosure of data
* manipulation of data
* reputational damage
#### prevention
* define data access policies
* implement data access controls
* enforce data access controls at application logic layer
* implement automated testing to  find BOLA flaws
* most common and damaging API vulnerability
### API2 : 2023 broken authentication
* endpoints have weak to no authentication mechanism/system
* 
#### examples
* weak passwords that are vulnerabile to
    - credential stuffing
    - brute force attacks
    - 
* no CAPTCHAs or rate limiting
* no lock-outs of accounts
* credential info is put on URLs (for example, as query parameters)
* changing passwords w/o authentication, authorisation or verification
* failing to validate tokens
* failing to store paswords properly
#### risk exposure
* attackers gain control of user accounts
* theft of data
* unauthorised transactions
#### prevention
* define authentication standards
* implement said authentication standards on the application logic level
* enforce said authentication standards
* follow best practices
### API3 : 2023 broken object property-level authorisation
* endpoints are exploited by reading and/or writing values of objects
* BOPLA is a merger of two previous OWASPs
    - mass assignment &rarr; attacker can update object elements e.g. account types
    - excessive data exposure &rarr; API returns too much information (e.g. return the whole user object instead of the user's name)
#### examples
* attacker/user can set account type to `premium` from `free`
* user `search` endpoint returns unnecessary information e.g. name, email, password etc
#### risk exposure
* protected user data may be revealed
#### prevention
* design an authorisation strategy/standards
* implement said strategy/standards at the app logic level
* enforce said strategy/standards
    - return only the data required for the use case
    - ensure users can access and/or modify only legitimate, permitted fields
### API4 : 2023 unrestricted resource consumption
* formerly `lack of resources and rate limiting`
* inadequate traffic control can allow
    - mass data retrieval
    - risk of operation interruption
#### examples
* missing or inadequate rate controls (set too high)
    - a user queries 1000 times when it only needs access once or twice
* lack of
    - execution timeouts
    - max allocatable memory
    - max number of file descriptors
    - max file upload size
* excessive ops in a single request
* excessive records returned in a single request
#### risk exposure
* DoS
* data harvesting
#### prevention
* define traffic control standards
* implement said traffic control standards on the application logic level
* enforce said traffic control standards
* follow best practices
### API5 : 2023 broken function-level authorisation
* abuse of API functionality to improperly modify objects (CRUD)
    - modify resources of another user
* often involves passive methods (`GET`) with active ones (`PUT`, `DELETE`)
#### examples
* modify paramaters
    - e.g. `PUT / HTTP ... ?role=admin` (add `admin` role to a regular user)
* delete an invoice
    - e.g. `DELETE / HTTP ... ?id=xXyY12bB` (delete invoice xXyY12bB)
* set account balance to zero
    - e.g. `PATCH / HTTP ... ?id=xXyY12b&balance=0` (set account id xXyY12bB's balance to zero)
#### risk exposure
* possible privilege  escalation
* modification of account details
* attackers may access unauthorised endpoints and functionality
* possible access to administrative endpoints/functions
#### prevention
* identify functions that expose high sensitivity capability and develop controls to limit access
* implement continuous release testing to ensure proper behaviour
### API6 : 2023 unrestricted access to sensitive business flows
* abuse of a legitimate business workflow through some sort of manipulation, excessive use, automated use or other
*  standard rate limiting caps and other types of technologies to prevent high volume transactions and can be defeated or bypassed using this vulnerability
    - rapid IP rotation, clearing cookies and other, distributed attacks can get around those types of defences
* typicaly a result of an application logic flaw
#### examples
* mass automated purchasing
    - API may be made to purchase the entire inventory and lock out the legitimate market from being able to access a service and/or good
    - e.g. buying all of the inventory of a new sneaker model or concert tickets w/i minutes of being posted online (instantly-sold-out products)
* high volume referral bonuses
    - say you give rewards to users for performing certain activities; that activity can be abused by users who want to create hundreds, thousands, millions of transactions and put your business at risk through those fraudulent transactions
    - think [endless shrimp][def] in an online market setting
#### risk exposure
* fraudulent transactions
* loss of critical business activity
* loss of revenues 
#### prevention
*  identify all business flows 
*  implement logic and controls to detect fraudulent traffic and prevent successful execution of transactions from said traffic
* test said logic and controls and verify that they work as intended
### API7 : 2023 server-side request forgery
* API endpoints accept URLs as input parameters provide an opening for malicious behaviour
* URL upload or input can create a channel for access to third party sites, malicious sites, downloading of malicious information/data/applications
#### examples
* a particular endpoint required the user to provide a URL, say, linkedin address
    - instead of putting a legitimate linkedin address, an attacker inserts `/localhost/api/user-data`
    - could have been a guess but what the attacker is doing is instruct the server to access the file(s) in `api/user-data/` on the host itself
    - assuming there are files, there may be user data
    - this data could potentially be returned to the attacker
    - w/o proper validation, the URL could be a pointer to a malicious site where there may be malware, key loggers and such other nice things
* local file injection
#### risk exposure
* SSRF
    - creates a channel for malicious requests, data access or other fraudulent activity
* potential data leaks
#### prevention
* do not trust anything (zero-trust policy)
    - do not try client-side validation
    - enable strict mode
    - read and use the OWASP web testing guide
* sanitise and validate user input
    - defang URLs
    - make sure user input is what you expect it to be (matches expected type and format)
    - remove any unsafe characters from user input
* implement testing and fuzzing
* escape late
* communicate w. only permitted w. trusted resources
### API8 : 2023 security misconfiguration
* broad category that encompasses misconfiguration of or lack of hardening on services
    - servers, network, apps etc
* use of bots to scan, detect and exploit misconfigurations
#### examples
* lack of security hardening
* improperly configured permissions
* missing security patches
* unnecessary features are enabled
* missing TLS
* CORS policy is missing or misconfigured
#### risk exposure
* potential exposure of sensitive data
* potential full server compromise
#### prevention
* design, implement and enforce hardening standards on the entire stack
* review configs routinely
* implement automated, continuous security testing
* make sure that your APIs can only be accessed by properly identified and approved sources
### API9 : 2023 improper inventory management
* API can be accessed using old, unused versions or through *"trusted"* 3<sup>rd</sup> parties
    - *"trusted"* because the API could not be vulnerable if they were really trustworthy
#### examples
* failing to retire API v3 when you upgrade to v4
#### risk exposure
* account and/or data theft
* sensitive data may be exposed
#### prevention
* enforce a strict policy for deploying all APIs (in a gateway)
* implement rules and processes for API versioning and retirement
* audit 3<sup>rd</sup> parties that access the API regularly and harden the access point(s)
### API10 : 2023 unsafe consumption of APIs
* 3<sup>rd</sup> party APIs that are, generally, trusted are exploited and used to attack the API(s) that depend on them
#### examples
* say your API performs user address verification
    - we want to make sure that the address is normalised, corrected and inserted into the DB in a clean way. say a 3<sup>rd</sup> party API is used
    - attacker may, in one way or another, insert malicious code/data into the 3<sup>rd</sup> party API
    - in the 3<sup>rd</sup> party API, the attacker may set the address to be, say, `DROP TABLE IF EXISTS` or equivalent
    - attacker then goes to your app's UI and  fill in the address field using the malicious value above
    - your app pulls the address record from the 3<sup>rd</sup> party API
    - congratulations; you now have an injection command in your environment
* URL redirects
    - your 3<sup>rd</sup> party API instructs users to go to another site
    - attacker can, simply, cause the 3<sup>rd</sup> party API to redirect users to a malicious site or worse
#### risk exposure
* data theft
* systems breach
* account takeover
#### prevention
* zero-trust policy
* validate, sanitise and/or escape input data
* audit 3<sup>rd</sup> party APIs and the requests/responses they send
* design, implement and enforce security testing and controls
* encrypt all API comms
* maintain and operate a whitelist of 3<sup>rd</sup> party APIs

[def]: https://news.northeastern.edu/2024/05/22/red-lobster-bankruptcy/