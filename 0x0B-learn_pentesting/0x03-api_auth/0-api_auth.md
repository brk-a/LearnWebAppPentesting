# API auth
* variants of API authentication
    - basic authentication
    - API keys
    - certificate-based authentication
    - token-based authentication
    - token-based authentication and authorisation
### authentication vs authorisation
* authentication &rarr; ***who are you?***
* authorisation &rarr; ***what are you allowed to do?***
* authentication is necessary for authorisation
    - you cannot tell what one is allowed to do if you cannot identify who that person/entity is
    - example: basic authentication scheme in the HTTP `Authorisation` header uses an username-password combination to authenticate an entity; it is hard to convey user identity because the machine identity is conveyed most of the time. in other words, authorisation is almost impossible

        ```text
            Authorisation: Basic Y2xpZkXQQ29yZDEw50dv61MT=
        ``` 

    - example: API keys. no standard way of presenting said keys; usually through a HTTP header. said header is, mor or less, a username-password combination. only machine identity is conveyed

        ```mermaid
        ---
        title: API key flow
        ---
            flowchart LR
            A[client]--> |my_secure_api_key| B[API]
        ```

    - example: TLS authentication. used heavily on the internet. auth is through [mutual TLS][def2]. HTTPS requires the server (or API) to present a certificate. both parties present certificates to authenticate themselves. machine identity is conveyed. uses the [zero-trust][def3] approach
        <img src="[def]" alt="tom_jerry-three_way_handshake"/>
    
    - example: token-based authentication. a trusted 3<sup>rd</sup> party (the caller) issues tokens. said tokens are used to authenticate the caller. they are valid for a specific amount of time and can have an audience (cannot be sent to certain parties). the API trusts the issuer of the token (which means you can fake a token). can convey user and machine identity
    - example: token-based authentication and authorisation. refer to the section above. tokens can convey more information; said info can be used for authorisation. a token may be valid but not ***"powerful"*** enough to provide access; OAuth uses scopes, OpenID Connect adds claims
* OAuth vs OpenID Connect
    - OAuth is a delegation protocol. API access is the main goal
    - OpenID Connect is an identity layer atop OAuth. defines user authentication metadata, can control authentication and supports  (a domain uses another domain to sign in)


[def]: /t-j-three-way.jpeg
[def2]: https://www.cloudflare.com/en-gb/learning/access-management/what-is-mutual-tls/
[def3]: https://en.wikipedia.org/wiki/Zero_trust_security_model