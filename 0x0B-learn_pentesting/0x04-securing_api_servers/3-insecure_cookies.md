# insecure cookies
* flow
    - cookie security
    - how to prevent customers' data from being harvested through cookies
### cookies
* [more info][def]
* small blocks of data created by a web server while a user is browsing a website
* placed on the user's computer or other device by the user's web browser
    - used to access a website
    - more than one cookie may be placed on a user's device during a session
* web server's response body has a `set-cookie` key that contains said cookie
* client's subsequent requests to the web server will have a `cookie` key that contains said cookie; this is how the web server identifies that specific client
### insecure cookies
* [more info][def2]
* are cookies stored w/o restrictive security
    - a cookie has certain security settings when created: `Secure`, `HTTP-Only` etc
* cookies, by nature, are cumulative: they keep as much information as is sent from the server
    - said server may add new key-value pairs to that cookie; the cookie simply adds it onto the existing data
    - there is time-to-live and a few other factors, however, there is enough information and so easily accessible that it can be accessed by anybody that wants to use it maliciously
* data in the cookie(s) is usually encoded using base64; base64 is relatively easy to decode especially when no [salt][def3] was added during encoding
* find keys/fields that contain PII or variables (say, `role`), for example
    - use delimiters to get the flow/structure of the cookie
* find data types
    - unique ID string
    - numeric ID
    - booleans
    - encoded data
* use available decoders, say, [md5][def4] or [base64][def5] to, well, decode the cookie
### the problem(s)
1. cookie forging/fuzzing &rarr; server trusts cookie data
    - change value(s) of keys in the cookie and send forged data to the server
    - see what the server returns
2. data harvesting, different site &rarr; `httponly` and no `domains`
    - set the `httponly`flag; the site cannot be manipulated using JS (req-res cycle carries on as ususal)
    - cookie is used in a different site
3. data harvesting using XSS &rarr; `httponly`
    - prerequisite: system must have a [XSS vulnerability][def6]
    - set the `httponly` flag to prevent this
4. data harvesting in transit &rarr; `secure` flag
    - set the `secure` flag to prevent this
    - cookie is encrypted in transit; whoever intercepts the cookie will see gobbledygook
### the solutions
1. treat cookies as untrusted user data; in other words, implement zero-trust policies by default
    - treat this data as you would data from a form: sanitise, sanitise, sanitise
2. be restrictive with what data is stored in a cookie
3. analyse your cookie(s) from an offensive perspective
    - check for information leaks, error disclosures etc
    - implement zero-trust policies
    - implement defensive security policies

    ```javascript
        res.cookie('exampleCookieName', 'client side persistence', {
            maxAge: 86400 * 1000000, // 24 hours
            httpOnly: true, //http only. prevents JS cookie access
            secure: true, //cookie must be sent over https/ssl
        })
    ```

[def]: https://en.wikipedia.org/wiki/HTTP_cookie
[def2]: https://owasp.org/www-chapter-london/assets/slides/OWASPLondon20171130_Cookie_Security_Myths_Misconceptions_David_Johansson.pdf
[def3]: https://en.wikipedia.org/wiki/Salt_(cryptography)
[def4]: https://md5hashing.net/hash/md5
[def5]: https://www.base64decode.org/
[def6]: https://owasp.org/www-community/attacks/xss/