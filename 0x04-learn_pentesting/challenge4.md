# prototype pollution

#### what the code does
* accepts a http request
* checks whether the key `token` exists in the header of said request
* if yes
    * decodes the value of `token` from `base64` using `Buffer.from()`
    * assigns it to a variable that has the same name as said key
    * checks whether
        * the value of key `token` (the variable) exists in the object `ANYOBJECT` (which is empty) and
        * variable `token` exists
    * if yes: returns `true` in the response
* if no: returns `false` in the response

#### what TF is prototype pollution?
* a JS vulnerability that enables an attacker to add arbitrary properties to global object prototypes which may then be inherited by user-defined objects
* more info on [portswigger][def]

#### the vulnerability
* prototype pollution

#### why it is vulnerable
* JS is a prototype-based language; everything is object and each object has a prototype
* every object in JS has a built-in property which is called its _prototype_. said prototype is itself an object, therefore, the _prototype_ has its own prototype; this is called a <em>prototype chain</em>. said chain ends when we reach a prototype whose prototype is `null` (think _linked lists_ in C)
* try the following in a `.js` file and run it

        ```javascript
        const myDate = new Date()
        let object = myDate

        do {
        object = Object.getPrototypeOf(object)
        console.log(object)
        } while (object)
        ```


* expect the following output

        
        Date.prototype
        Object { }
        null
        

* code walks up the prototype chain startting from `Date.prototype` and ending at `null`
* recall, every object has a prototype; an empty object, therefore, has a prototype
* this can be used against the script viz:

        ```javascript
        //snip
        if(ANYOBJECT["__proto__"] && "__proto__"){
                //do sth
        }
        //snip
        ```


* both `ANYOBJECT["__proto__"]` and `"__proto__"` are truthy values, therefore, the response returns `true` in the response

#### what now?
* fail to use `if(ANYOBJECT[token] && token){...}` 
* use `hasOwnProperty` method of `ANYOBJECT` viz

        ```javascript
        if(ANYOBJECT.hasOwnProperty(token) && token){...}
        ```


[def]: https://portswigger.net/web-security/prototype-pollution