# Broken Object-Level Authorisation (BOLA)

#### API specific
#### Business specific
#### Exploitability: easy
#### Prevalence: widespread
#### Detectability: easy
#### Technical: moderate

### threat agents/attack vectors
* attackers can exploit API endpoints that are vulnerable to BOLA by manipulating the ID of an object that is sent within the [body of a] request
* object IDs can be anything from sequential integers, UUIDs or generic strings
* regardless of the data type, they are easy to identify in the request target (path or query string parameters), request headers or request payload

### security weakness
* this issue is quite common to API-based applications because the server component, usually, does not fully track the client’s state
* instead, it relies more on parameters, like object IDs, that are sent from the client to decide which objects to access
* the server response is usually enough to understand whether the request was successful
* access-controlled detection is not, typically, amenable to automated static or dynamic testing
* developers may, and do, forget to use access control detection tools/mechanisms before accessing a sensitive object 

### impact
* unauthorised access to other users’ objects may result in:
    * data disclosure to unauthorised parties
    * data loss
    * data manipulation
* under certain circumstances, unauthorised access to objects can also lead to full account takeover

### example
* assume that P, an authenticated user, accesses his own record at the endpoint
`/api/v3/users?id=2727` (B's user id is 2727)
* also, assume that the response viz:

    ```json
        {
            "id": "2727",
            "fname": "Pe",
            "lname": "Te",
            "dob": "1970-01-01",
            "username": "pete",
            "diagnosis": "Depression",
        }
    ```
* this is alright; P accesses P's data
* say that P, using his own authorisation, can access Z's data at the endpoint `/api/v3/users?id=2728`
    * this is not alright; each must not access the other's data
    * the endpoint `/api/v3/users?id={id}` is vulnerable to BOLA
* variations

    ||when API presents reqs this way|try this to find vulns|
    |:---:|:---|:---|
    |1.|GET /api/user/*1*|GET /api/user/*3*|
    |2.|GET /user/account/find?*user_id=aE1230986token*|GET /user/account/find?*user_id=12*|
    |3.|POST /company/account/*Safaricom*/balance|POST /company/account/*Equity*/balance|
    |4.|GET /admin/settings/account/*pete*|GET /admin/settings/account/*zeke*|

### How To Prevent

* implement a proper authorisation mechanism that relies on the user policies and hierarchy
* use said authorisation mechanism to check if the logged-in user has access to perform the requested action on the record in every function that uses an input from the client to access a record in the database
* prefer the use of random and unpredictable values as GUIDs for record IDs
* write tests to evaluate the vulnerability of the authorisation mechanism; do not deploy changes that make the tests fail
