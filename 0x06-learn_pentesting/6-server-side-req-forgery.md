# server-side request forgery (SSRF)

#### API specific
#### Business specific
#### Exploitability: easy
#### Prevalence: widespread
#### Detectability: easy
#### Technical: moderate


### threat agents/attack vectors
* exploitation requires the attacker to find an API endpoint that accesses a URI that is provided by the client
* in general, basic SSRF (when the response is returned to the attacker) is easier to exploit than _blind SSRF_ where the attacker has no feedback on whether or not the attack was successful

### security weakness
* modern concepts in application development encourage developers to access URIs provided by the client
* lack of or improper validation of such URIs are common issues
* regular API requests and response analysis will be required to detect the issue
* when the response is not returned (blind SSRF), detecting the vulnerability requires more effort and creativity
* about SSRF
    * an app is vulnerable to SSRF when an app itself retrieves resources w/o input validation
    * attacker can use this to control what the server requests
    * attacker accesses sensitive data, compromises the host and leverages the target server to process the attacker's requests

### impact
* successful exploitation might lead to internal services enumeration (e.g. port scanning), information disclosure, bypassing firewalls or other security mechanisms
* in some cases, it can lead to DoS or the server being used as a proxy to hide malicious activities

### example
* intercepted request

    ```text
        POST api/v1/store/products
        headers...
        {
            "inventory":"http://store.com/api/v3/inventory/item/1234"
        }
    ```
* attack

    ```text
        POST api/v1/store/products
        headers...
        {
            "inventory":"§http://localhost/secrets§"
        }
    ```

* response

    ```text
        HTTP/1.1 200 OK
        headers...
        {
            "secret token":"S3crE74dm1Nt0k3N"
        }
    ```

### how To prevent
* isolate the resource fetching mechanism in your network; usually these features are aimed to retrieve remote resources and not internal ones
* whenever possible, use allow lists of:
    * remote origins users are expected to download resources from (e.g. google drive, gravatar, etc.)
    * URL schemes and ports
     accepted media types for a given functionality
* disable HTTP redirections
* use a well-tested and maintained URL parser to avoid issues caused by URL parsing inconsistencies
* validate and sanitise all client-supplied input data
* do not send raw responses to clients