# broken function-level authorisation (BAFLA)

#### API specific
#### Business specific
#### Exploitability: easy
#### Prevalence: common
#### Detectability: easy
#### Technical: severe


### threat agents/attack vectors
* exploitation requires the attacker to send legitimate API calls to an API endpoint that they should not have access to as anonymous users or regular, non-privileged users
* exposed endpoints will be easily exploited

### security weakness
* authorisation checks for a function or resource are usually managed via configuration or code level
* implementing proper checks can be a confusing task since modern applications can contain many types of roles, groups and complex user hierarchies (e.g. sub-users, or users with more than one role)
* it is easier to discover these flaws in APIs since APIs are more structured and accessing different functions is more predictable

### impact
* such flaws allow attackers to access unauthorised functionality
* administrative functions are key targets for this type of attack and may lead to data disclosure, data loss or data corruption
* ultimately, it may lead to service disruption

### example
* BOLA vs BAFLA
    * a fintech app vulnerable to BOLA allows user A to view user B's account
    * a fintech app vulnerable to BAFLA allows user A to transact on user B's account
* a bank website with endpoints for different privileged actions
    * `/{userid}/account/balance` -> user a/c info
    * `/admin/account/{userid}` -> admin endpoint
    * admin endpoint can be exploited if API has improper access controls
        * an attacker can perform admin actions, a/c takeover etc
* APIs at an org whose HTTP request methods are unrestricted
    * attacker can exploit unrestricted methods to suit the purpose of the attack


### how To prevent
* your application should have a consistent and easy-to-analyse authorisation module that is invoked from all your business functions. such protection is provided by one or more components external to the application code
    * the enforcement mechanism(s) should deny all access by default and require explicit grants to specific roles for access to every function
    * review your API endpoints against function level authorisation flaws while keeping in mind the business logic of the application and groups hierarchy
    * make sure that all of your administrative controllers inherit from an administrative abstract controller that implements authorization checks based on the user's group/role
    * make sure that administrative functions inside a regular controller implement authorisation checks based on the user's group and role